<!DOCTYPE html>
<html lang="en">

<head>
    <%- include('../../partials/head.ejs'); %>
</head>

<body>
    <!-- navbar -->
    <%- include('../../partials/navbar.ejs'); %>

    <div v-cloak id="app">
        <!-- For rendev vuetify  -->
        <v-app>

            <!-- content -->
            <main class="main-content position-relative max-height-vh-100 h-100 border-radius-lg content">
                <div class="container-fluid py-2">
                    <div class="row">
                        <div class="col-12">
                            <div class="card mb-4">
                                <div class="card-header pb-3">
                                    <div class="row">
                                        <div class="col-3 col-md-3">
                                            <h6>History ticket</h6>
                                            <div class="sub-title">ประวัติการแจ้ง</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="card-body px-3 pt-0 pb-2">
                                    <!-- search -->
                                    <div class="w-25 ms-md-auto pe-md-3 d-flex align-items-center mb-3">
                                        <div class="input-group">
                                            <span class="input-group-text text-body"><i class="fas fa-search"
                                                    aria-hidden="true"></i></span>
                                            <input v-model="table.search" type="text" class="form-control px-3"
                                                placeholder="Type here...">
                                        </div>
                                    </div>

                                    <div class="table-responsive px-2">
                                        <v-data-table class="table align-items-center mb-0" :headers="table.headers"
                                            :items="table.items" :search="table.search" :items-per-page="5"
                                            class="elevation-1">

                                            <!-- DATE CREATED -->
                                            <template v-slot:item.create_date="{ item }">
                                                <span class="text-secondary text-xs font-weight-bold">
                                                    {{ moment.unix(item.create_date).format('DD/MM/YYYY h:mm') }}</span>
                                            </template>


                                            <!-- INFORMER -->
                                            <template v-slot:item.mname="{ item }">
                                                <div class="d-flex px-2 py-1">
                                                    <div>
                                                        <img src="/assets/images/team-3.jpg"
                                                            class="avatar avatar-sm me-3" alt="user1">
                                                    </div>
                                                    <div class="d-flex flex-column justify-content-center">
                                                        <h6 class="mb-0 text-sm">{{ item.mname }}</h6>
                                                        <p class="text-xs text-secondary mb-0">{{ item.mcode }}</p>
                                                    </div>
                                                </div>
                                            </template>

                                            <!-- TYPE -->
                                            <template v-slot:item.catalog_name="{ item }">
                                                <p class="text-xs font-weight-bold mb-0">{{ item.catalog_nameTH }}</p>
                                                <p class="text-xs text-secondary mb-0">{{ item.catalog_nameEN }}</p>
                                            </template>

                                            <!-- STATUS -->
                                            <template v-slot:item.status="{ item }">
                                                <span v-if="item.status == 'Close'"
                                                    class="badge badge-font-dark badge-sm bg-gradient-success">
                                                    {{ item.status }}</span>

                                                <span v-else class="badge badge-sm badge-font-dark bg-gradient-warning">
                                                    {{ item.status }}</span>
                                            </template>

                                            <!-- LAST UPDATE -->
                                            <template v-slot:item.approve_date="{ item }">
                                                <span v-if="item.approve_date != 0"
                                                    class="text-secondary text-xs font-weight-bold">
                                                    {{ moment.unix(item.approve_date).format('DD/MM/YYYY h:mm') }}</span>

                                                <span v-else class="text-secondary text-xs font-weight-bold">
                                                    - </span>
                                            </template>

                                            <!-- VIEW -->
                                            <template v-slot:item.actions="{ item }">
                                                <a class="btn btn-link pe-3 ps-0 mb-0 ms-auto"
                                                    :href="`/user/support/scm/thread/detail/${item.ticket_id}`">
                                                    VIEW
                                                </a>
                                            </template>
                                        </v-data-table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>


        </v-app>
    </div>

    <!-- new ticket modal end -->
    <%- include('../../partials/footer.ejs'); %>

    <script type="text/javascript">
        const baseUrl = "<%- baseUrl %>";

        let app = new Vue({
            el: "#app",
            vuetify: new Vuetify(), // called vuetify
            data: {

            },


            watch: {

            },


            computed: {

            },


            methods: {
                clearModal() {
                    this.form.selectType = ''
                    this.form.inputDetail = ''
                    this.$refs.file.value = null;
                },

                uploadFile(event) {
                    this.form.fileUpload = event.target.files[0];
                },

            },

            async created() {

            },

            mounted() {
                // clear modal when dismiss
                $(this.$refs.newticketmodal).on("hidden.bs.modal", this.clearModal)
            },
        });
    </script>
</body>

</html>